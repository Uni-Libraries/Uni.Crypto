set(ENABLE_TESTING OFF CACHE BOOL "mbedtls testing" FORCE)
set(ENABLE_PROGRAMS OFF CACHE BOOL "mbedtls programs" FORCE)
set(MBEDTLS_AS_SUBPROJECT ON CACHE BOOL "mbedtls subproject" FORCE)
set(DISABLE_PACKAGE_CONFIG_AND_INSTALL ON CACHE BOOL "mbedtls install" FORCE)

if(UNI_CRYPTO_STM)
    add_subdirectory(3rdparty/mbedtls_stm32)
else()
    add_subdirectory(3rdparty/mbedtls)
endif()

if(UNI_CRYPTO_STM)
    target_compile_definitions(mbedcrypto PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config-stm32.h")
    target_compile_definitions(mbedtls    PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config-stm32.h")
    target_compile_definitions(mbedx509   PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config-stm32.h")
else()
    target_compile_definitions(mbedcrypto PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config.h")
    target_compile_definitions(mbedtls    PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config.h")
    target_compile_definitions(mbedx509   PUBLIC MBEDTLS_CONFIG_FILE="${CMAKE_CURRENT_LIST_DIR}/mbedtls-config.h")
endif()
